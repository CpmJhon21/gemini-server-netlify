<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant | By CPM_JHON</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <style>
/* Reset & Global Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Inter', system-ui, sans-serif;
}

body {
    background-color: #111827;
    color: #f3f4f6;
    height: 100vh;
    display: flex;
    flex-direction: column;
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
}

/* Header */
.header {
    background-color: #1e1e2d;
    position: fixed;
    top: 0;
    width: 100%;
    max-width: inherit;
    z-index: 10;
    border-bottom: 1px solid #2d2d3d;
}

.header-content {
    display: flex;
    align-items: center;
    padding: 0.75rem 1.25rem;
    gap: 1rem;
}

/* Profile */
.profile-container {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
}

.profile-image, .profile-pic {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(45deg, #4f46e5, #6366f1);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: white;
    border: 2px solid #2d2d3d;
}

/* Chat Container */
.chat-container {
    flex: 1;
    overflow-y: auto;
    padding: 8.5rem 1rem 7rem 1rem;
    scroll-behavior: smooth;
    background: linear-gradient(to bottom, #131320, #1a1a2e);
}

/* Chat Messages */
.message {
    display: flex;
    align-items: flex-end;
    margin: 10px 0;
    max-width: 85%;
    padding: 1rem 1.25rem;
    border-radius: 1.25rem;
    position: relative;
    word-wrap: break-word;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    animation: slideIn 0.3s ease-out;
}

.message-content {
    max-width: 85%;
    padding: 10px;
    border-radius: 8px;
    position: relative;
}

/* User Message */
.user-message {
    justify-content: flex-end;
}

.user-message .message-content {
    background: linear-gradient(135deg, #4f46e5, #6366f1);
    color: white;
    border-top-right-radius: 0;
}

/* Assistant Message */
.assistant-message {
    justify-content: flex-start;
}

.assistant-message .message-content {
    background-color: #1f2937;
    color: #f3f4f6;
    border: 1px solid #2d2d3d;
    border-top-left-radius: 0;
}

/* Timestamp */
.timestamp {
    font-size: 12px;
    color: #bbb;
    display: block;
    text-align: right;
    margin-top: 5px;
}

/* Typing Indicator */
.typing-indicator {
    display: flex;
    align-items: center;
    margin-left: 40px;
    background-color: #1f2937;
    padding: 1rem;
    border-radius: 1.25rem;
    border-bottom-left-radius: 0.5rem;
    border: 1px solid #2d2d3d;
}

.dots span {
    display: inline-block;
    width: 6px;
    height: 6px;
    background-color: white;
    border-radius: 50%;
    margin-right: 3px;
    animation: typingBounce 1.5s infinite ease-in-out;
}

@keyframes typingBounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

/* Input Container */
.input-container {
    position: fixed;
    bottom: 0;
    width: 100%;
    max-width: inherit;
    padding: 1rem;
    background-color: #1e1e2d;
    border-top: 1px solid #2d2d3d;
}

.input-wrapper {
    display: flex;
    gap: 0.75rem;
    max-width: 100%;
    margin: 0 auto;
    background-color: #161622;
    padding: 0.5rem;
    border-radius: 9999px;
    border: 1px solid #2d2d3d;
}

#prompt {
    flex: 1;
    padding: 0.75rem 1.25rem;
    border-radius: 9999px;
    border: none;
    background-color: transparent;
    color: #f3f4f6;
    font-size: 0.938rem;
    outline: none;
}

button {
    background: linear-gradient(135deg, #4f46e5, #6366f1);
    color: white;
    border: none;
    border-radius: 9999px;
    padding: 0.75rem 1.5rem;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease;
}

button:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

button:disabled {
    background: #374151;
    cursor: not-allowed;
}

/* Animations */
@keyframes slideIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Responsive */
@media (max-width: 768px) {
    .header-content {
        padding: 0.75rem 1rem;
    }

    .message {
        max-width: 90%;
        margin: 0.75rem 0;
        padding: 0.75rem 1rem;
    }

    button span {
        display: none;
    }

    button {
        padding: 0.75rem;
    }
}
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="profile-container">
                <div class="profile-image">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="profile-info">
                    <div class="profile-name">AI Assistant | Cpm_Jhon</div>
                </div>
            </div>
        </div>
        <div class="credit">Powered by CPM_JHON</div>
    </div>

    <div class="chat-container" id="chat-container">
        <div class="welcome-message">
            <h2>Welcome to AI Assistant! | Cpm_Jhon</h2>
            <p>I'm here to help you. Feel free to ask me anything.</p>
        </div>
    </div>

    <div class="toast" id="toast">Copied to clipboard!</div>

    <div class="input-container">
        <div class="input-wrapper">
            <input 
                type="text" 
                id="prompt" 
                placeholder="Type your message..."
                onkeypress="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); generateContent(); }"
            />
            <button onclick="generateContent()" id="submit-btn">
                <i class="fas fa-paper-plane"></i>
                <span>Send</span>
            </button>
        </div>
    </div>
    <script>
marked.setOptions({
    highlight: function (code, lang) {
        if (lang && hljs.getLanguage(lang)) {
            return hljs.highlight(code, { language: lang }).value;
        }
        return hljs.highlightAuto(code).value;
    },
    breaks: true
});

let isGenerating = false;

function showToast(message) {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 2000);
}

function appendMessage(content, isUser = false) {
    const chatContainer = document.getElementById('chat-container');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${isUser ? 'user-message' : 'assistant-message'}`;

    if (isUser) {
        messageDiv.textContent = content;
    } else {
        messageDiv.innerHTML = marked.parse(content);
        messageDiv.querySelectorAll('pre').forEach((pre) => {
            // Hapus tombol copy yang sudah ada agar tidak duplikat
            pre.querySelectorAll('.copy-button').forEach(btn => btn.remove());

            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.innerHTML = '<i class="fas fa-copy"></i><span>Copy</span>';
            copyButton.onclick = () => {
                const code = pre.querySelector('code').innerText;
                navigator.clipboard.writeText(code)
                    .then(() => showToast('Copied to clipboard!'))
                    .catch(() => showToast('Failed to copy!'));
            };

            pre.appendChild(copyButton);
            hljs.highlightElement(pre.querySelector('code'));
        });
    }

    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

function showTypingIndicator() {
    const chatContainer = document.getElementById('chat-container');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'typing-indicator';
    typingDiv.innerHTML = `
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
    `;
    chatContainer.appendChild(typingDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
    return typingDiv;
}

function removeTypingIndicator(indicator) {
    if (indicator && indicator.parentElement) {
        indicator.remove();
    }
}

async function generateContent() {
    if (isGenerating) return;

    const promptInput = document.getElementById('prompt');
    const submitBtn = document.getElementById('submit-btn');
    const chatContainer = document.getElementById('chat-container');

    const prompt = promptInput.value.trim();
    if (!prompt) return;

    isGenerating = true;
    promptInput.disabled = true;
    submitBtn.disabled = true;

    // Tambahkan pesan user ke chat
    appendMessage(prompt, "user");

    // Tampilkan animasi typing
    const typingIndicator = showTypingIndicator();
    promptInput.value = '';

    try {
        const response = await fetch("/api/generate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ prompt: prompt })
        });

        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.json();
        removeTypingIndicator(typingIndicator);

        // Tambahkan pesan AI ke chat
        appendMessage(data.response || "No response available.", "ai");
    } catch (error) {
        removeTypingIndicator(typingIndicator);
        appendMessage("Error connecting to server.", "ai");
        console.error('Error:', error);
    } finally {
        isGenerating = false;
        promptInput.disabled = false;
        submitBtn.disabled = false;
        promptInput.focus();
    }
}

// FUNGSI appendMessage() DILETAKKAN DI BAWAH
let isGenerating = false;

// Fungsi untuk mendapatkan waktu saat ini dalam format jam:menit:detik
function getCurrentTime() {
    const now = new Date();
    return now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
}

// Fungsi untuk menambahkan pesan ke chat
function appendMessage(text, isUser = false) {
    const chatContainer = document.getElementById('chat-container');

    // Buat elemen pesan
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message', isUser ? 'user-message' : 'assistant-message');

    // Tambahkan foto profil
    const profilePic = document.createElement('img');
    profilePic.classList.add('profile-pic');
    profilePic.src = isUser ? "user.png" : "ai.png";
    profilePic.alt = isUser ? "User" : "AI";

    // Bungkus konten pesan
    const messageContent = document.createElement('div');
    messageContent.classList.add('message-content');
    
    // Tambahkan teks pesan
    messageContent.innerHTML = `<p>${text}</p>`;

    // Tambahkan timestamp
    const timestamp = document.createElement('span');
    timestamp.classList.add('timestamp');
    timestamp.textContent = getCurrentTime();
    messageContent.appendChild(timestamp);

    // Gabungkan elemen-elemen
    messageDiv.appendChild(profilePic);
    messageDiv.appendChild(messageContent);
    chatContainer.appendChild(messageDiv);

    // Scroll ke bawah otomatis
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Fungsi untuk menampilkan indikator mengetik
function showTypingIndicator() {
    const chatContainer = document.getElementById('chat-container');
    
    const typingDiv = document.createElement('div');
    typingDiv.classList.add('typing-indicator');
    typingDiv.innerHTML = `
        <img src="ai.png" class="profile-pic" alt="AI">
        <div class="dots"><span></span><span></span><span></span></div>
    `;

    chatContainer.appendChild(typingDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;

    return typingDiv;
}

// Fungsi untuk menghapus indikator mengetik
function removeTypingIndicator(typingIndicator) {
    if (typingIndicator) typingIndicator.remove();
}

// Fungsi utama untuk mengirim pesan dan mendapatkan balasan AI
async function generateContent() {
    if (isGenerating) return;

    const promptInput = document.getElementById('prompt');
    const submitBtn = document.getElementById('submit-btn');

    const prompt = promptInput.value.trim();
    if (!prompt) return;

    isGenerating = true;
    promptInput.disabled = true;
    submitBtn.disabled = true;

    // Tambahkan pesan user ke chat
    appendMessage(`<strong>You:</strong> ${prompt}`, true);
    
    // Tampilkan indikator mengetik
    const typingIndicator = showTypingIndicator();
    promptInput.value = '';

    try {
        const response = await fetch("/api/generate", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ prompt: prompt })
        });

        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.json();
        removeTypingIndicator(typingIndicator);

        // Tambahkan pesan AI ke chat
        appendMessage(`<strong>AI:</strong> ${data.response || "No response available."}`);
    } catch (error) {
        removeTypingIndicator(typingIndicator);
        appendMessage(`<strong>AI:</strong> Error connecting to server.`);
        console.error('Error:', error);
    } finally {
        isGenerating = false;
        promptInput.disabled = false;
        submitBtn.disabled = false;
        promptInput.focus();
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const promptInput = document.getElementById('prompt');
    promptInput.focus();
});
    </script>
    </body>
    </html>
